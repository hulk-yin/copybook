events {
  # worker_connections      20480;
}


http {
  default_type            application/octet-stream;
  tcp_nopush              on;
  server_tokens           off;
  keepalive_timeout       0;

  server_names_hash_bucket_size  64;
  gzip                    on;
  gzip_http_version       1.0;
  gzip_comp_level         6;
  gzip_min_length         1024;
  gzip_proxied            any;
  gzip_vary               on;
  gzip_disable            msie6;
  gzip_buffers            96 8k;
  gzip_types              text/xml text/plain text/css application/javascript application/x-javascript application/rss+xml application/json;

  # proxy_set_header        Host $host;
  proxy_set_header        X-Real-IP $remote_addr;
  proxy_set_header        Web-Server-Type nginx;
  proxy_set_header        WL-Proxy-Client-IP $remote_addr;
  proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_redirect          off;
  proxy_buffers           128 8k;
  # proxy_temp_path         data/proxy;
  proxy_intercept_errors  on;
  
  proxy_cache_path /root levels=1:2 keys_zone=the_cache_zone:10m inactive=10d max_size=512m use_temp_path=off;

  
  map $env $cacheControl {
    dev no-cache ;
    fat "max-age=180" ;
    uat "max-age=180" ;
    prod "max-age=525600" ;
    default "max-age=525600" ;
  }
  map $host $staticPath {
    default "statics-dev";
    ~\.dev\.ennew\.com "statics-dev";
    ~\.fat\.ennew\.com "statics-fat";
    ~\.uat\.ennew\.com "statics-uat";
    ~localhost "statics-dev";
    ~^\w+\.ennew\.com "statics-pro";
  }
      
 server {
    listen 80 default_server;
    server_name ~^static\.(?:(\w+)\.)?ennew\.com;
    set $env "$1";
  
 # 生产环境逻辑

    rewrite ^/$ /index.html;

     # element 原站点地址
    location /statics/ennew/frontend_-frame/ {
      proxy_cache the_cache_zone;
      proxy_pass  https://lfrz1.stor.enncloud.cn/ennew-dev/public/qT8I30Ep8LClHsA9/render-server/statics/ennew/frontend_-frame/;
      proxy_pass_header Cache-Control;
      add_header Cache-Control  $cacheControl;
      add_header X-Env $env;
      add_header X-Host $host;

      if ($uri ~* "\.mjs$" ) {
          add_header Content-Type application/javascript;
      }
      # proxy_cache_valid 30d;
    }

     # element 原站点地址
    location /statics/@enn/ {
      proxy_cache the_cache_zone;
      proxy_pass  https://lfrz1.stor.enncloud.cn/ennew-dev/public/qT8I30Ep8LClHsA9/render-server/statics/@enn/;
      proxy_pass_header Cache-Control;
      add_header Cache-Control  $cacheControl;
      add_header X-Env $env;
      add_header X-Host $host;

      if ($uri ~* "\.mjs$" ) {
          add_header Content-Type application/javascript;
      }
      # proxy_cache_valid 30d;
    }

    location / {
      proxy_cache the_cache_zone;
      set $bcknd  https://lfrz1.stor.enncloud.cn/ennew-pro/public/qT8I30Ep8LClHsA9/fe-baas/$staticPath$uri$is_args$args;
      proxy_pass $bcknd;
      proxy_pass_header Cache-Control;
      add_header Cache-Control  $cacheControl;
      add_header X-Env $env always;
      add_header X-Real-Path $staticPath always;
      add_header X-Host $host always;
      add_header X-Bcknd-Path $bcknd always;
      # proxy_cache_valid 30d;
      if ($uri ~* "\.mjs$" ) {
        add_header Content-Type application/javascript;
      }
    }
  }

  server {
    listen 80 ;
    server_name ~^ency\.(dev\.)?ennew\.com$;
    rewrite ^/$ /index.html;

    location /dist/ {
      proxy_pass  https://lfrz1.stor.enncloud.cn/ennew-dev/public/qT8I30Ep8LClHsA9/render-server/statics/@enn/ency-design/dist/;
      # proxy_pass_header Content-Type; 
      if ($uri ~* "\.mjs$" ) {
          # proxy_hide_header Content-Type;
          add_header Content-Type application/javascript;
      }
    }
    location /icons/ {
      proxy_pass  https://lfrz1.stor.enncloud.cn/ennew-dev/public/qT8I30Ep8LClHsA9/render-server/statics/@enn/ency-design-icons/dist/;
      # https://lfrz1.stor.enncloud.cn/ennew-dev/public/qT8I30Ep8LClHsA9/render-server/statics/@enn/ency-design-icons/dist/index.js
      # proxy_pass_header Content-Type; 
      if ($uri ~* "\.mjs$" ) {
          # proxy_hide_header Content-Type;
          add_header Content-Type application/javascript;
      }
    }
    
    location / {
      proxy_pass  https://lfrz1.stor.enncloud.cn/ennew-dev/public/qT8I30Ep8LClHsA9/render-server/statics/@enn/ency-design-doc/1.0.0/;
      # proxy_pass_header Content-Type; 
      if ($uri ~* "\.mjs$" ) {
          # proxy_hide_header Content-Type;
          add_header Content-Type application/javascript;
      }
    }
  }
  

  server {
    listen 80 ;
    server_name ~^ency-design-(\w+)\.(?:(\w+)\.)?ennew\.com;
    set $docName "$1";
    set $env "$2";

    rewrite ^/$ /index.html;
   
    set $bcknd "https://lfrz1.stor.enncloud.cn/ennew-dev/public/qT8I30Ep8LClHsA9/render-server/statics/@enn/ency-design-$docName-doc/1.0.0$uri$is_args$args";
 
    location / {

      add_header X-Host $host always;
      add_header X-DOCNAME $docName always;
      add_header X-env $env always;
      add_header X-BACKEND $bcknd always;

      proxy_pass  $bcknd;
      if ($uri ~* "\.mjs$" ) {
          add_header Content-Type application/javascript;
      }
    }
  }


  server {
    listen 80 ;
    server_name ~^run\.(?:(\w+)\.)?ennew\.com$;
    rewrite ^/$ /index.html;

    location / {
      proxy_pass  https://lfrz1.stor.enncloud.cn/ennew-dev/public/qT8I30Ep8LClHsA9/render-server/statics/@enn/ency-design-playground/1.0.0/;
      # proxy_pass_header Content-Type; 
      if ($uri ~* "\.mjs$" ) {
          # proxy_hide_header Content-Type;
          add_header Content-Type application/javascript;
      }
    }
  }
}
